---
output: html_document
editor_options: 
  chunk_output_type: console
---


# Energiforbruk

## Eksempel på forflytning med ulik oppakning

For å finne ut hvor mye marsj med oppakning koster i energi finnes det formler som er utarbeidet med bakgrunn i laboratorietester. Pandolf's formel blir ofte brukt til å kalkulere energiforbruket $M_w$ (i watt) ved forflytning med oppakning og har følgende formel:

<!--- Men vi har ikke kontroll på arbeidsøkonomi, utnyttingsgrad ect, dermed er ikke utregning helt presis, men den gir oss en god indikasjon hvordan oppakning påvirker ulike personer i forhold til kroppsvekt og ulik oppakning.-->

$$M_w = 1.5 W\ +\ 2.0(W + L) (L/W)^2\ +\ T(W + L)(1.5  V^2 + 0.35VG)$$

hvor $W$ er kroppsvekt i kg, $L$ er oppakning i kg, $T$ er terreng faktor, $V$ er hastighet/marsj hastighet (m/s), $G$ = grader/helning i %.  
  
I @tbl-energi har jeg lagt inn tre personer (ID) med ulik kroppsvekt og to ulike oppakninger. Terreng faktor, hastighet og helning er konstante mellom personene i disse eksemplene.


```{r echo=FALSE, warning=FALSE, message=FALSE}
#| label: tbl-data
#| tbl-cap: Tabell med variabler for utregning av energiforbruk

library(tidyverse)

# From the article 

df <- data.frame(fp= c("1", "1", "2", "2","3","3"),
                 body.weight =c('50','50', '70','70', '90','90'),
                 load=c(25, 38),
                 terrain="1.1",
                 velocity="1.2",
                 grade="0")


kableExtra::kable(df,
                  align = c("l", "c"),
                  col.names = c('ID',
                                'Kroppsvekt (kg)', 
                                'Oppakning (kg)', 
                                'Terreng faktor', 
                                'Hastighet (m/s)', 
                                'Helning')) |> 
    kableExtra::add_footnote(
    escape = FALSE,
    label = "Terreng faktor: 1.1 samsvarer med grusvei på en skala som går fra 1.0, som er asfalt, til 4.1 som tilsvarer 35 cm løs snø [@colosio_2018].",
notation = "alphabet",
threeparttable = FALSE)
```


I @tbl-energi har jeg kalkulert energiforbruket med Pandolf's formel. Formelen kalkulerer energiforbruket i *watt* for så å legge inn en faktor for å konvergere det til *Kcal*. Vi får da energiforbruket til personen i *Kcal per minutt*.

Hvordan tolker vi disse dataene?

```{r echo=FALSE, warning=FALSE, message=FALSE}
#| label: tbl-energi
#| tbl-cap: Energiforbruk ved ulik kroppsvekt og kilo oppakning.

library(tidyverse)


## Dette skriptet regner ut energiforbruk per min (kcal per minutt)

# 10.1136/jramc-2017-000887

my_list <- list(
  weight = c(50, 50, 70, 70, 90, 90),
  load = c(25, 35, 25, 35, 25, 35),
  terrain= c(1.1),
  velocity = 1.2,
  grade = 0)

# Extract constants
w <- my_list$weight
t <- my_list$terrain
v <- my_list$velocity
g <- my_list$grade

# Prepare result vector
result <- numeric(length(c(my_list$load)))

# For loop over different load and weight
for (i in seq_along(c(my_list$load & my_list$weight))) {
  l <- my_list$load[i]
  w <- my_list$weight[i]
  
  result[i] <- 1.5 * w +
    2.0 * (w + l) * (l / w)^2 +
    t * (w + l) * (1.5 * v^2 + 0.35 * v * g) 
  
}

# View results

my_list$result <- result

r <- data.frame(my_list)


result_2 <- numeric(length(my_list$result))

# For loop over weight body mass
## Hva skjer når vi kontrollerer for kroppsvekt, w
## Per time, * 60 min

for (i in seq_along(my_list$result)) {
  r <- my_list$result[i]
  w <- my_list$weight[i]
  
  result_2[i] <- r * 0.01433
  
}


my_list$result_2 <- result_2

df <-  data.frame(my_list) |> 
  mutate(across(c(result, result_2), ~ round(.x, 3))) |> 
  mutate(fp = c("1","1", "2","2","3","3")) |> 
  dplyr::select(fp, weight:result_2)

kableExtra::kable(df,
                  col.names = c('ID',
                                'Kroppsvekt (kg)', 
                                'Oppakning (kg)', 
                                'Terreng faktor', 
                                'Hastighet (m/s)', 
                                'Helning', 
                                "Watt", 
                                "Kcal / min")) |> 
  kableExtra::add_footnote(
    escape = FALSE,
    label = "Konverterer Watt til Kcal med faktor: 1 W = 0.014333 kcal per min. \\\\",
notation = "alphabet",
threeparttable = TRUE
)

```

- MEN, hva skjer når vi kontrollerer for personers kroppsvekt?
- Hvem forbruker mest energi med å forflytte seg egentlig?

I @tbl-energi2 har jeg lagt inn kroppsvekt og kontrollert for dette i utregningen.

```{r echo=FALSE, warning=FALSE, message=FALSE}
#| label: tbl-energi2
#| tbl-cap: Energiforbruk ved ulik kroppsvekt og kilo oppakning.

library(tidyverse)


## Dette skriptet kalkulerer energiforbruket per kg per min


# 10.1136/jramc-2017-000887

my_list <- list(
  weight = c(50, 50, 70, 70, 90, 90),
  load = c(25, 35, 25, 35, 25, 35),
  terrain= c(1.1),
  velocity = 1.2,
  grade = 0)

# Extract constants
w <- my_list$weight
t <- my_list$terrain
v <- my_list$velocity
g <- my_list$grade

# Prepare result vector
result <- numeric(length(c(my_list$load)))

# For loop over different load and weight
for (i in seq_along(c(my_list$load & my_list$weight))) {
  l <- my_list$load[i]
  w <- my_list$weight[i]
  
  result[i] <- 1.5 * w +
    2.0 * (w + l) * (l / w)^2 +
    t * (w + l) * (1.5 * v^2 + 0.35 * v * g) 
  
}

# View results

my_list$result <- result

r <- data.frame(my_list)


result_2 <- numeric(length(my_list$result))

# For loop over weight body mass
## Hva skjer når vi kontrollerer for kroppsvekt, w
## Per time, * 60 min

for (i in seq_along(my_list$result)) {
  r <- my_list$result[i]
  w <- my_list$weight[i]
  
  result_2[i] <- r * 0.01433 / w
  
}


my_list$result_2 <- result_2

df <-  data.frame(my_list) |> 
  mutate(across(c(result, result_2), ~ round(.x, 3))) |> 
  mutate(fp = c("1","1", "2","2","3","3")) |> 
  dplyr::select(fp, weight:result_2)

kableExtra::kable(df,
                  col.names = c('ID',
                                'Kroppsvekt (kg)', 
                                'Oppakning (kg)', 
                                'Terreng faktor', 
                                'Hastighet (m/s)', 
                                'Helning', 
                                "Watt", 
                                "Kcal / kg / min")) |> 
  kableExtra::add_footnote(
    escape = FALSE,
    label = "Konverterer Watt til Kcal med faktor: 1 W = 0.014333 kcal per min. \\\\",
notation = "alphabet",
threeparttable = TRUE
)


### Pandolfs equations metabolic cost of walking (watts)
#
## Body mass (kg)
#w <- 60
#
## Load mass (kg)
#l <- 30
#
## Terrain factor
## 1.1 dirt road to 4.1 for soft snow (35cm)
#t <-  1.1
#
## Velocity or walk rate (m/s)
#v <- 2.2
#
## Grade (%)
#g <-  0
#
## Metabolic cost of walking (watts)
#
#mw <- 1.5 * w + 2.0 * (w + l) * (l / w)^2 + t * (w+l) * (1.5 * v^2 + 0.35 * v * g)
#
#mw_kg <- (mw * 0.01433) / weight
#
#mw_kg * 120
### Epsteins equation (metabolic cost)
## Metabolic cost of running (watts)
#
#met.cost <- mw - 0.5 * (1-0.01 * l) * (mw - 15 * l -850)
#
## Kcal per kg / min
#
#kcal_kg <- (met.cost * 0.01433) / w
#
#kcal <- (met.cost * 0.01433)
#
#kcal_kg
#kcal

```


I @tbl-energi3 er energiforbruk per time kalkulert.

- Hvordan burde man disponere oppakningen i laget for å optimalisere stridsevnen for hele laget gitt energiforbruket mellom personene i tabellen?

```{r echo=FALSE, warning=FALSE, message=FALSE}
#| label: tbl-energi3
#| tbl-cap: Energiforbruk ved ulik kroppsvekt og kilo oppakning.

library(tidyverse)


## Dette skriptet kalkulerer energiforbruket per kg per min + utregning per 60 min


# 10.1136/jramc-2017-000887

my_list <- list(
  weight = c(50, 50, 70, 70, 90, 90),
  load = c(25, 35, 25, 35, 25, 35),
  terrain= c(1.1),
  velocity = 1.2,
  grade = 0)

# Extract constants
w <- my_list$weight
t <- my_list$terrain
v <- my_list$velocity
g <- my_list$grade

# Prepare result vector
result <- numeric(length(c(my_list$load)))

# For loop over different load and weight
for (i in seq_along(c(my_list$load & my_list$weight))) {
  l <- my_list$load[i]
  w <- my_list$weight[i]
  
  result[i] <- 1.5 * w +
    2.0 * (w + l) * (l / w)^2 +
    t * (w + l) * (1.5 * v^2 + 0.35 * v * g) 
  
}

# View results

my_list$result <- result

r <- data.frame(my_list)


result_2 <- numeric(length(my_list$result))

# For loop over weight body mass
## Hva skjer når vi kontrollerer for kroppsvekt, w
## Per time, * 60 min

for (i in seq_along(my_list$result)) {
  r <- my_list$result[i]
  w <- my_list$weight[i]
  
  result_2[i] <- r * 0.01433 / w * 60
  
}


my_list$result_2 <- result_2

df <-  data.frame(my_list) |> 
  mutate(across(c(result, result_2), ~ round(.x, 3))) |> 
  mutate(fp = c("1","1", "2","2","3","3")) |> 
  dplyr::select(fp, weight:result_2)

kableExtra::kable(df,
                  col.names = c('ID',
                                'Kroppsvekt (kg)', 
                                'Oppakning (kg)', 
                                'Terreng faktor', 
                                'Hastighet (m/s)', 
                                'Helning', 
                                "Watt", 
                                "Kcal / kg / time")) |> 
  kableExtra::add_footnote(
    escape = FALSE,
    label = "Konverterer Watt til Kcal med faktor: 1 W = 0.014333 kcal per min. \\\\",
notation = "alphabet",
threeparttable = TRUE
)


```


